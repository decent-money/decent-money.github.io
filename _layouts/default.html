<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8">
    {% assign _site_title = site.title | escape %}
    {% assign _page_title = page.title | default: site.title | escape %}
    {% assign _page_description = page.description | default: site.description | escape %}
    {% assign _page_url = page.url | absolute_url %}
    {% assign _image = page.og_image | default: page.social_image | default: site.og_image | default: site.logo | default: '/dm2k9_logo.png' | relative_url | absolute_url %}
    {% assign _image_width = page.social_image_width | default: site.social_image_width | default: 1200 %}
    {% assign _image_height = page.social_image_height | default: site.social_image_height | default: 630 %}
    {% assign _image_alt = page.image_alt | default: page.social_image_alt | default: site.image_alt | default: _page_title %}
    {% assign _site_name = site.title | escape %}

    {% if page.url == "/" %}
    <title>{{ _site_title }}</title>
    {% else %}
    <title>{{ _page_title }} | {{ _site_title }}</title>
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="{{ _page_description }}">
    <meta name="robots" content="{% if page.noindex or site.noindex %}noindex{% else %}index{% endif %}, {% if page.nofollow or site.nofollow %}nofollow{% else %}follow{% endif %}">
    <link rel="canonical" href="{{ _page_url }}">

    <!-- Open Graph -->
    <meta property="og:type" content="{% if page.layout == 'post' or page.date %}article{% else %}website{% endif %}">
    <meta property="og:title" content="{{ _page_title }}">
    <meta property="og:description" content="{{ _page_description }}">
    <meta property="og:url" content="{{ _page_url }}">
    <meta property="og:site_name" content="{{ _site_name }}">
    <meta property="og:image" content="{{ _image }}">
    <meta property="og:image:secure_url" content="{{ _image }}">
    <meta property="og:image:width" content="{{ _image_width }}">
    <meta property="og:image:height" content="{{ _image_height }}">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:alt" content="{{ _image_alt }}">
    {% if page.date %}
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
    {% endif %}

    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _page_title }}">
    <meta name="twitter:description" content="{{ _page_description }}">
    <meta name="twitter:image" content="{{ _image }}">
    <meta name="twitter:image:alt" content="{{ _image_alt }}">
    {% if site.twitter_username %}
    <meta name="twitter:site" content="@{{ site.twitter_username | replace: '@', '' }}">
    {% endif %}

    <link rel="icon" href="{{ '/favicon.png' | relative_url }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  </head>
  <body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand-logo" href="{{ '/' | relative_url }}">
      <span class="brand-text">
        <span class="brand-title">DM2K9.net</span>
      </span>
    </a>
  </div>
</header>


    <main class="site-main">
      <div class="container">
        {{ content }}
      </div>
    </main>

<footer class="site-footer">
  <div class="container site-footer-inner">
    <div>¬© {{ site.time | date: "%Y" }} Decent Money</div>
    <div class="footer-lightning-wrap">
      <span class="footer-lightning-prefix">Tip/Zap with Bitcoin:</span>
      <a id="lightningLink"
         class="footer-lightning"
         href="lightning:greyfox3@primal.net"
         data-ln="greyfox3@primal.net"
         rel="nofollow">‚ö° greyfox3@primal.net</a>
    </div>
    <div class="footer-links">
      <a class="mirror-link"
         data-primary="https://dm2k9.net"
         data-mirror="https://decent-money.github.io/"
         href="https://decent-money.github.io/"
         target="_blank"
         rel="noopener">
        <span class="mirror-text">Mirror</span>
      </a>
      <a href="https://github.com/decent-money" target="_blank" rel="noopener">GitHub</a>
      <a href="https://x.com/decentmoney2009" target="_blank" rel="noopener">ùïè</a>
      <a id="nostrCopyLink"
         href="#"
         title="Click/tap to copy npub"
         aria-label="npub10k0zrnsujm856xrvx7ftw2m66xsx39em620slh4eecympt5833pq97rf0x"
         data-npub="npub10k0zrnsujm856xrvx7ftw2m66xsx39em620slh4eecympt5833pq97rf0x">nostr</a>
    </div>
  </div>
</footer>

<script>
  (() => {
    const link = document.getElementById('nostrCopyLink');
    if (!link || !navigator.clipboard) return;
    const npub = link.dataset.npub;
    const original = link.textContent;
    let resetTimer;

    link.addEventListener('click', e => {
      e.preventDefault();
      navigator.clipboard.writeText(npub).then(() => {
        link.textContent = 'npub copied';
        clearTimeout(resetTimer);
        resetTimer = setTimeout(() => {
          link.textContent = original;
        }, 1200);
      });
    });
  })();

  (() => {
    const lnLink = document.getElementById('lightningLink');
    if (!lnLink) return;

    const addr = lnLink.dataset.ln;
    const original = lnLink.textContent;
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
      navigator.userAgent || ''
    );
    let resetTimer;

    lnLink.addEventListener('click', e => {
      e.preventDefault();
      const lightningUrl = `lightning:${addr}`;

      if (isMobile) {
        window.location.href = lightningUrl;
        return;
      }

      const showCopied = () => {
        lnLink.textContent = '‚ö° copied lightning address';
        clearTimeout(resetTimer);
        resetTimer = setTimeout(() => {
          lnLink.textContent = original;
        }, 1200);
      };

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(addr).then(showCopied);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = addr;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showCopied();
      }
    });
  })();

  (() => {
    const mirror = document.querySelector('.mirror-link');
    if (!mirror) return;

    const primary = mirror.dataset.primary || 'https://dm2k9.net';
    const secondary = mirror.dataset.mirror || 'https://decent-money.github.io/';
    const host = window.location.hostname;
    const onMirror = host.includes('decent-money.github.io');
    mirror.href = onMirror ? primary : secondary;

    const text = mirror.querySelector('.mirror-text');
    if (!text) return;
    const states = [
      'normal',            // no transform
      'mirror-h',          // horizontal flip, reversed order
      'mirror-h-order',    // horizontal flip, normal order
      'mirror-v',          // vertical flip, normal order
      'mirror-v-reverse',  // vertical flip, reversed order
      'mirror-hv',         // both flips, reversed order
      'mirror-hv-order'    // both flips, normal order
    ];
    const choice = states[Math.floor(Math.random() * states.length)];
    if (choice !== 'normal') text.classList.add(choice);
  })();
</script>
  </body>
</html>
